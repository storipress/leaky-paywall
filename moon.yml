# yaml-language-server: $schema=https://moonrepo.dev/schemas/project.json

project:
  name: leaky-paywall
  description: Storipress Leaky Paywall

type: library
language: typescript

tasks:
  build:
    command:
      - vite
      - build
    inputs: 
      - '@globs(sources)'
      - package.json
      - yarn.lock
    outputs:
      - dist
    deps:
      - ~:typecheck
    platform: node
  lib:
    command:
      - vite
      - build
    inputs: 
      - '@globs(sources)'
      - package.json
      - yarn.lock
      - vite.config.ts
    outputs:
      - lib
    args:
      - --mode=lib
    deps:
      - ~:typecheck
    platform: node
  lib-analyze:
    extends: lib
    outputs:
      - lib
      - stats.html
    env:
      ANALYZE: 'true'
  minify:
    command:
      - node
      - esbuild.config.js
    inputs: 
      - lib/leaky-paywall.js
    outputs:
      - lib/leaky-paywall.min.js
    deps:
      - ~:lib-analyze
  show-analyze:
    command:
      - open
      - stats.html
    inputs:
      - stats.html
    options:
      runInCI: false
    deps:
      - ~:lib-analyze
    platform: node
  deploy:
    command: noop
    deps:
      - ~:minify
  size:
    command:
      - size-limit
    deps:
      - ~:minify
      - ~:show-analyze
  typecheck:
    command: vue-tsc
    platform: node
    inputs: 
      - '@globs(sources)'
      - tsconfig.json
      - package.json
      - yarn.lock
  dev:
    command: vite
    args:
      - --open
    local: true
    platform: node
