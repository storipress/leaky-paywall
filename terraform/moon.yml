project:
  name: terraform
  description: Deploy leaky-paywall to CDN

type: automation

dependsOn:
  - leaky-paywall

tasks:
  init:
    command:
      - terraform
      - init
  fmt:
    deps:
      - init
    command:
      - terraform
      - fmt
  plan:
    command:
      - terraform
      - plan
    inputs:
      - /lib/leaky-paywall.min.js
      - /lib/leaky-paywall-debug.min.js
      - /lib/leaky-paywall-preview.min.js
      - $TF_VAR_aws_access_key
      - $TF_VAR_aws_secret_key
      - '*.tfvars'
      - .terraform.lock.hcl
      - '*.tf'
    deps:
      - init
      - ^:deploy
  deploy:
    command:
      - terraform
      - apply
      - -auto-approve
    inputs:
      - /lib/leaky-paywall.min.js
      - /lib/leaky-paywall-debug.min.js
      - /lib/leaky-paywall-preview.min.js
      - $TF_VAR_aws_access_key
      - $TF_VAR_aws_secret_key
      - '*.tfvars'
      - .terraform.lock.hcl
      - '*.tf'
    deps:
      - init
      - ^:deploy
